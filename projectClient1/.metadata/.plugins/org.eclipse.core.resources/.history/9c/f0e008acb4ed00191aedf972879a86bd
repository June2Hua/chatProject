package com.zjh.swingDemo;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Frame;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.PrintStream;
import java.net.Socket;
import java.util.Scanner;

import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextArea;
import javax.swing.JTextField;

//发送信息
public class ChatClient {
	public static final String ip="127.0.0.1";//服务器的ip地址
	public static final int port=30000;//服务器的端口号
	private Socket socket;//创建与服务器连接的Socket
	private ClientThread client;
	JTextArea showText;//显示信息窗口
	JLabel userName;//用户名
	JTextField inputText;//输入框
	JButton sendInfo;//发送信息按钮
	JButton sendFile;//发送文件按钮
	JFrame frame;//用户界面
	JPanel panel;//最后一行集合
	PrintStream printer;
	public void init(String name)throws Exception{
		socket=new Socket(ip,port);
		showText=new JTextArea();//显示窗口
		//开启客户端线程，用于监听服务器信息
		client=new ClientThread(name,socket,showText);
		client.start();
		frame=new JFrame();
		userName=new JLabel();//用户名
		userName.setText(name);//设置名字
		inputText=new JTextField();//输入窗口
		sendInfo=new JButton("发送信息");//发送信息按钮
		sendFile=new JButton("发送文件");//发送信息按钮
		panel=new JPanel();
		printer = new PrintStream(socket.getOutputStream());
		//点击事件
		sendInfo.addActionListener(new ActionListener() {
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				String info=inputText.getText();
				sendInfo(info);
			}
		});
		sendFile.addActionListener(new ActionListener() {
			@Override
			public void actionPerformed(ActionEvent e) {
				// TODO Auto-generated method stub
				String path=inputText.getText();
				sendFile(path);
			}
		});
		inputText.setPreferredSize(new Dimension(180,30));
		panel.add(inputText);
		panel.add(sendInfo);
		panel.add(sendFile);
		BorderLayout layout=new BorderLayout();
		frame.setLayout(layout);
		frame.add(userName,BorderLayout.NORTH);
		showText.setPreferredSize(new Dimension(300,200));//设置大小
		showText.setEditable(false);//设置不可编辑
		showText.setLineWrap(true);
		frame.add(showText,BorderLayout.CENTER);
		frame.add(panel,BorderLayout.SOUTH);
		frame.pack();
		frame.setVisible(true);
	}
	//以下用于发送信息到server
	public void sendInfo(String info){
		try {
			printer.println(client.getName()+":"+info);//输出信息到server端
			inputText.setText("");
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}//用于发送信息到server
	}
	//发送文件
	public void sendFile(String path){
		try {
			File file=new File(path);
			printer.println("file:"+file.getName());
			InputStream inputStream=new FileInputStream(file);
			BufferedReader reader=new BufferedReader(new InputStreamReader(inputStream));
			String tmp;
			while((tmp=reader.readLine())!=null){
				printer.println(tmp);
			}
			inputText.setText("");
			inputStream.close();
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}//用于发送信息到server
	}
}
